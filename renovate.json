{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "enabledManagers": ["custom.regex"],
  "labels": ["dependencies"],
  "baseBranches": ["main", "test/renovate"],
  "useBaseBranchConfig": "merge",
  "customManagers" : [
    {
      "customType": "regex",
      "fileMatch": [".gitlab-ci.yml"],
      "matchStrings": [
        "  DATADOG_AGENT_[^:]*: (?<currentValue>v.*)"
      ],
      "depNameTemplate": "buildimages",
      "versioningTemplate": "loose",
      "datasourceTemplate": "custom.buildimages"
    },
    {
      "customType": "regex",
      "fileMatch": ["Dockerfile"],
      "matchStrings": [
        "ENV GO_VERSION=(?<currentValue>.*)"
      ],
      "depNameTemplate": "gover",
      "versioningTemplate": "loose",
      "datasourceTemplate": "custom.gover"
    },
    {
        "customType": "regex",
        "fileMatch": ["release.json"],
        "matchStrings": [
          "[ ]+\"OMNIBUS_RUBY_VERSION\": \"(?<currentValue>[a-z0-9]+)\""
        ],
        "depNameTemplate": "omnibus-ruby",
        "versioningTemplate": "loose",
        "datasourceTemplate": "custom.omnibus-ruby"
     }
  ],
  "customDatasources": {
    "buildimages": {
      "defaultRegistryUrlTemplate": "https://hub.docker.com/v2/namespaces/datadog/repositories/agent-buildimages-deb_x64/tags",
      "transformTemplates": [
        "{\"releases\": $map(results, function($v) { {\"version\": $v.name, \"releaseTimestamp\": $v.last_updated } }) }"
      ]
    },
    "gover": {
      "defaultRegistryUrlTemplate": "https://raw.githubusercontent.com/DataDog/datadog-agent/refs/heads/main/.go-version",
      "format": "plain"
    },
    "omnibus-ruby": {
      "defaultRegistryUrlTemplate": "https://api.github.com/repos/datadog/omnibus-ruby/commits",
      "transformTemplates": [
        "{\"releases\": $map($.[sha,commit.author.date], function($v) { {\"version\": $v[0], \"releaseTimestamp\": $v[1] } }) }"
      ]
    }
  }
}
